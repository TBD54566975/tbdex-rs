<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Title</title>
    <script>
      const getOfferings = async () => {
        document.getElementById("getOfferingsButton").disabled = true;
        document.getElementById("indication").textContent = "Loading...";
        const response = await fetch("/frontend/api/offerings");
        const offerings = await response.json();
        document.getElementById("getOfferingsResponse").style.display = "block";
        document.getElementById("offerings").textContent = JSON.stringify(
          offerings,
          null,
          2
        );
        document.getElementById("indication").textContent =
          "Now submit the RFQ";
        document.getElementById("submitRfqButton").disabled = false;
      };

      const submitRfq = async () => {
        document.getElementById("submitRfqButton").disabled = true;
        document.getElementById("indication").textContent = "Loading...";
        const response = await fetch("/frontend/api/submit-rfq", {
          method: "POST",
        });
        const rfq = await response.json();
        document.getElementById("submitRfqResponse").style.display = "block";
        document.getElementById("rfq").textContent = JSON.stringify(
          rfq,
          null,
          2
        );
        document.getElementById("indication").textContent =
          "Waiting for Quote...";

        let continuePolling = true;
        while (continuePolling) {
          const response = await fetch("/frontend/api/poll-quote");
          if (response.status == 200) {
            const quote = await response.json();
            document.getElementById("getQuoteResponse").style.display = "block";
            document.getElementById("quote").textContent = JSON.stringify(
              quote,
              null,
              2
            );
            document.getElementById("indication").textContent =
              "Now submit the Order";
            document.getElementById("submitOrderButton").disabled = false;
            continuePolling = false;
          }

          await new Promise((resolve) => setTimeout(resolve, 3000));
        }
      };

      const submitOrder = async () => {
        document.getElementById("submitOrderButton").disabled = true;
        document.getElementById("indication").textContent = "Loading...";
        const response = await fetch("/frontend/api/submit-order", {
          method: "POST",
        });
        const order = await response.json();
        document.getElementById("submitOrderResponse").style.display = "block";
        document.getElementById("order").textContent = JSON.stringify(
          order,
          null,
          2
        );
        document.getElementById("indication").textContent =
          "Waiting for order execution...";

        let continuePolling = true;
        while (continuePolling) {
          const response = await fetch("/frontend/api/poll-order-statuses");
          if (response.status === 200) {
            const orderStatuses = await response.json();
            document.getElementById("orderStatusesResponse").style.display =
              "block";
            document.getElementById("orderStatuses").textContent =
              JSON.stringify(orderStatuses, null, 2);
          }

          const closeResponse = await fetch("/frontend/api/poll-close");
          if (closeResponse.status === 200) {
            const close = await closeResponse.json();
            document.getElementById("closeResponse").style.display = "block";
            document.getElementById("close").textContent = JSON.stringify(
              close,
              null,
              2
            );
            document.getElementById("indication").textContent =
              "Exchange completed successfully!";
            continuePolling = false;
          }
        }
      };
    </script>
    <style>
      #closeResponse,
      #orderStatusesResponse,
      #submitOrderResponse,
      #getQuoteResponse,
      #submitRfqResponse,
      #getOfferingsResponse {
        display: none;
      }
    </style>
  </head>
  <body>
    <h1>Example UX</h1>
    <button id="getOfferingsButton" onclick="getOfferings()">
      Get Offerings
    </button>
    <button id="submitRfqButton" disabled onclick="submitRfq()">
      Submit RFQ
    </button>
    <button id="submitOrderButton" disabled onclick="submitOrder()">
      Submit Order
    </button>
    <p id="indication">Begin by clicking Get Offerings</p>

    <div id="closeResponse">
      <p>Close</p>
      <pre id="close"></pre>
    </div>
    <div id="orderStatusesResponse">
      <p>Order Statuses</p>
      <pre id="orderStatuses"></pre>
    </div>
    <div id="submitOrderResponse">
      <p>Order</p>
      <pre id="order"></pre>
    </div>
    <div id="getQuoteResponse">
      <p>Quote</p>
      <pre id="quote"></pre>
    </div>
    <div id="submitRfqResponse">
      <p>RFQ</p>
      <pre id="rfq"></pre>
    </div>
    <div id="getOfferingsResponse">
      <p>Offerings</p>
      <pre id="offerings"></pre>
    </div>
  </body>
</html>
